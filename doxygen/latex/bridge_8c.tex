\hypertarget{bridge_8c}{\section{bridge/bridge.c File Reference}
\label{bridge_8c}\index{bridge/bridge.\-c@{bridge/bridge.\-c}}
}


Serial bridge.  


{\ttfamily \#include \char`\"{}user\-\_\-config.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}bridge.\-h\char`\"{}}\\*
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
static I\-C\-A\-C\-H\-E\-\_\-\-F\-L\-A\-S\-H\-\_\-\-A\-T\-T\-R void \hyperlink{bridge_8c_a51f0a2a4b9021881c02d8ef82ff9ae8d}{tcp\-\_\-accept} (struct espconn $\ast$esp\-\_\-config, esp\-\_\-tcp $\ast$esp\-\_\-tcp\-\_\-config, \hyperlink{send_8c_a273cf69d639a59973b6019625df33e30}{uint16\-\_\-t} port, void($\ast$connect\-\_\-callback)(struct espconn $\ast$))
\begin{DoxyCompactList}\small\item\em Accept an incomming connection, setup connect\-\_\-callback. \end{DoxyCompactList}\item 
static I\-C\-A\-C\-H\-E\-\_\-\-F\-L\-A\-S\-H\-\_\-\-A\-T\-T\-R void \hyperlink{bridge_8c_a9479d1a576b84bc3e8438f9446dda1a6}{tcp\-\_\-data\-\_\-sent\-\_\-callback} (void $\ast$arg)
\begin{DoxyCompactList}\small\item\em Network transmit finished callback function. \end{DoxyCompactList}\item 
static I\-C\-A\-C\-H\-E\-\_\-\-F\-L\-A\-S\-H\-\_\-\-A\-T\-T\-R void \hyperlink{bridge_8c_a619c74cf1ce880ac9e37bebdd33fc1ab}{tcp\-\_\-data\-\_\-receive\-\_\-callback} (void $\ast$arg, char $\ast$data, \hyperlink{send_8c_a273cf69d639a59973b6019625df33e30}{uint16\-\_\-t} length)
\begin{DoxyCompactList}\small\item\em Network receive callback function. \end{DoxyCompactList}\item 
static I\-C\-A\-C\-H\-E\-\_\-\-F\-L\-A\-S\-H\-\_\-\-A\-T\-T\-R void \hyperlink{bridge_8c_a40b8ea487cbc82321048ce6fa67271c0}{tcp\-\_\-data\-\_\-disconnect\-\_\-callback} (void $\ast$arg)
\begin{DoxyCompactList}\small\item\em Network disconnect callback function. \end{DoxyCompactList}\item 
static I\-C\-A\-C\-H\-E\-\_\-\-F\-L\-A\-S\-H\-\_\-\-A\-T\-T\-R void \hyperlink{bridge_8c_a90c84952368e3f93c28af840f9e5fc69}{tcp\-\_\-data\-\_\-connect\-\_\-callback} (struct espconn $\ast$new\-\_\-connection)
\begin{DoxyCompactList}\small\item\em incomming connection setup callbacks \end{DoxyCompactList}\item 
I\-C\-A\-C\-H\-E\-\_\-\-F\-L\-A\-S\-H\-\_\-\-A\-T\-T\-R \hyperlink{bridge_8c_acc614f131d017f7d630eb9e1b0cb8c25}{bridge\-\_\-task\-\_\-init} (int port)
\begin{DoxyCompactList}\small\item\em Serial Bridge task initialize. \end{DoxyCompactList}\item 
static I\-C\-A\-C\-H\-E\-\_\-\-F\-L\-A\-S\-H\-\_\-\-A\-T\-T\-R void \hyperlink{bridge_8c_a97584e49ad206983bf3e1602da072b48}{bridge\-\_\-task} (os\-\_\-event\-\_\-t $\ast$events)
\begin{DoxyCompactList}\small\item\em Main serial bridge task. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
os\-\_\-event\-\_\-t \hyperlink{bridge_8c_ad261f9ed25a58b55949fac376fd1e0af}{bridge\-\_\-task\-\_\-queue} \mbox{[}\hyperlink{bridge_8h_adf764cbdea00d65edcd07bb9953ad2b7a552c882e309f228ce140280b133abdf2}{bridge\-\_\-task\-\_\-queue\-\_\-length}\mbox{]}
\begin{DoxyCompactList}\small\item\em E\-S\-P8266 O\-S task queue. \end{DoxyCompactList}\item 
\hyperlink{structqueue__t}{queue\-\_\-t} $\ast$ \hyperlink{bridge_8c_a1b67aab34790ec2d9256a1b50eecadb6}{uart\-\_\-send\-\_\-queue}
\begin{DoxyCompactList}\small\item\em uart send queue \end{DoxyCompactList}\item 
\hyperlink{structqueue__t}{queue\-\_\-t} $\ast$ \hyperlink{bridge_8c_ab25ba18581f43bfb622b9265183a501c}{uart\-\_\-receive\-\_\-queue}
\begin{DoxyCompactList}\small\item\em uart receive queue \end{DoxyCompactList}\item 
static char $\ast$ \hyperlink{bridge_8c_a543efc3afa23ef26b2799af3a29389b5}{tcp\-\_\-data\-\_\-send\-\_\-buffer}
\begin{DoxyCompactList}\small\item\em T\-C\-P send buffer. \end{DoxyCompactList}\item 
static char \hyperlink{bridge_8c_a36560c07b79d9d574575c3e54f24b032}{tcp\-\_\-data\-\_\-send\-\_\-buffer\-\_\-busy}
\begin{DoxyCompactList}\small\item\em T\-C\-P send buffer busy flag. \end{DoxyCompactList}\item 
static struct espconn $\ast$ \hyperlink{bridge_8c_a4603e319b9122f08d771fd0cffcd624b}{esp\-\_\-data\-\_\-tcp\-\_\-connection}
\begin{DoxyCompactList}\small\item\em network connection \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Serial bridge. \begin{DoxyParagraph}{Copyright \copyright{} 2015 Mike Gore, G\-P\-L License}

\end{DoxyParagraph}
\begin{DoxyParagraph}{You are free to use this code under the terms of G\-P\-L}
Please retain a copy of this notice in any code you use it in.
\end{DoxyParagraph}
This is free software\-: you can redistribute it and/or modify it under the terms of the G\-N\-U General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.

This software is distributed in the hope that it will be useful, but W\-I\-T\-H\-O\-U\-T A\-N\-Y W\-A\-R\-R\-A\-N\-T\-Y; without even the implied warranty of M\-E\-R\-C\-H\-A\-N\-T\-A\-B\-I\-L\-I\-T\-Y or F\-I\-T\-N\-E\-S\-S F\-O\-R A P\-A\-R\-T\-I\-C\-U\-L\-A\-R P\-U\-R\-P\-O\-S\-E. See the G\-N\-U General Public License for more details.

You should have received a copy of the G\-N\-U General Public License along with this program. If not, see \href{http://www.gnu.org/licenses/}{\tt http\-://www.\-gnu.\-org/licenses/}. 

Definition in file \hyperlink{bridge_8c_source}{bridge.\-c}.



\subsection{Function Documentation}
\hypertarget{bridge_8c_a97584e49ad206983bf3e1602da072b48}{\index{bridge.\-c@{bridge.\-c}!bridge\-\_\-task@{bridge\-\_\-task}}
\index{bridge\-\_\-task@{bridge\-\_\-task}!bridge.c@{bridge.\-c}}
\subsubsection[{bridge\-\_\-task}]{\setlength{\rightskip}{0pt plus 5cm}static I\-C\-A\-C\-H\-E\-\_\-\-F\-L\-A\-S\-H\-\_\-\-A\-T\-T\-R void bridge\-\_\-task (
\begin{DoxyParamCaption}
\item[{os\-\_\-event\-\_\-t $\ast$}]{events}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{bridge_8c_a97584e49ad206983bf3e1602da072b48}


Main serial bridge task. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em $\ast$events} & event signal message strurture -\/ not used \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}


Definition at line 191 of file bridge.\-c.



Referenced by bridge\-\_\-task\-\_\-init().

\hypertarget{bridge_8c_acc614f131d017f7d630eb9e1b0cb8c25}{\index{bridge.\-c@{bridge.\-c}!bridge\-\_\-task\-\_\-init@{bridge\-\_\-task\-\_\-init}}
\index{bridge\-\_\-task\-\_\-init@{bridge\-\_\-task\-\_\-init}!bridge.c@{bridge.\-c}}
\subsubsection[{bridge\-\_\-task\-\_\-init}]{\setlength{\rightskip}{0pt plus 5cm}I\-C\-A\-C\-H\-E\-\_\-\-F\-L\-A\-S\-H\-\_\-\-A\-T\-T\-R bridge\-\_\-task\-\_\-init (
\begin{DoxyParamCaption}
\item[{int}]{port}
\end{DoxyParamCaption}
)}}\label{bridge_8c_acc614f131d017f7d630eb9e1b0cb8c25}


Serial Bridge task initialize. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em port} & network port \\
\hline
\end{DoxyParams}


Definition at line 159 of file bridge.\-c.



Referenced by user\-\_\-init().

\hypertarget{bridge_8c_a51f0a2a4b9021881c02d8ef82ff9ae8d}{\index{bridge.\-c@{bridge.\-c}!tcp\-\_\-accept@{tcp\-\_\-accept}}
\index{tcp\-\_\-accept@{tcp\-\_\-accept}!bridge.c@{bridge.\-c}}
\subsubsection[{tcp\-\_\-accept}]{\setlength{\rightskip}{0pt plus 5cm}static I\-C\-A\-C\-H\-E\-\_\-\-F\-L\-A\-S\-H\-\_\-\-A\-T\-T\-R void tcp\-\_\-accept (
\begin{DoxyParamCaption}
\item[{struct espconn $\ast$}]{esp\-\_\-config, }
\item[{esp\-\_\-tcp $\ast$}]{esp\-\_\-tcp\-\_\-config, }
\item[{{\bf uint16\-\_\-t}}]{port, }
\item[{void($\ast$)(struct espconn $\ast$)}]{connect\-\_\-callback}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{bridge_8c_a51f0a2a4b9021881c02d8ef82ff9ae8d}


Accept an incomming connection, setup connect\-\_\-callback. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em $\ast$esp\-\_\-config,E\-S\-P8266} & network type an mode configuration structure \\
\hline
\mbox{\tt in}  & {\em $\ast$esp\-\_\-tcp\-\_\-config,network} & protocol structure \\
\hline
\mbox{\tt in}  & {\em port,network} & port to listen on \\
\hline
\mbox{\tt in}  & {\em connect\-\_\-callback} & connection callback function pointer \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}


Definition at line 56 of file bridge.\-c.



Referenced by bridge\-\_\-task\-\_\-init().

\hypertarget{bridge_8c_a90c84952368e3f93c28af840f9e5fc69}{\index{bridge.\-c@{bridge.\-c}!tcp\-\_\-data\-\_\-connect\-\_\-callback@{tcp\-\_\-data\-\_\-connect\-\_\-callback}}
\index{tcp\-\_\-data\-\_\-connect\-\_\-callback@{tcp\-\_\-data\-\_\-connect\-\_\-callback}!bridge.c@{bridge.\-c}}
\subsubsection[{tcp\-\_\-data\-\_\-connect\-\_\-callback}]{\setlength{\rightskip}{0pt plus 5cm}static I\-C\-A\-C\-H\-E\-\_\-\-F\-L\-A\-S\-H\-\_\-\-A\-T\-T\-R void tcp\-\_\-data\-\_\-connect\-\_\-callback (
\begin{DoxyParamCaption}
\item[{struct espconn $\ast$}]{new\-\_\-connection}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{bridge_8c_a90c84952368e3f93c28af840f9e5fc69}


incomming connection setup callbacks 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em $\ast$new\-\_\-connection} & \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}


Definition at line 134 of file bridge.\-c.



Referenced by bridge\-\_\-task\-\_\-init().

\hypertarget{bridge_8c_a40b8ea487cbc82321048ce6fa67271c0}{\index{bridge.\-c@{bridge.\-c}!tcp\-\_\-data\-\_\-disconnect\-\_\-callback@{tcp\-\_\-data\-\_\-disconnect\-\_\-callback}}
\index{tcp\-\_\-data\-\_\-disconnect\-\_\-callback@{tcp\-\_\-data\-\_\-disconnect\-\_\-callback}!bridge.c@{bridge.\-c}}
\subsubsection[{tcp\-\_\-data\-\_\-disconnect\-\_\-callback}]{\setlength{\rightskip}{0pt plus 5cm}static I\-C\-A\-C\-H\-E\-\_\-\-F\-L\-A\-S\-H\-\_\-\-A\-T\-T\-R void tcp\-\_\-data\-\_\-disconnect\-\_\-callback (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{arg}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{bridge_8c_a40b8ea487cbc82321048ce6fa67271c0}


Network disconnect callback function. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em $\ast$arg} & unused \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}


Definition at line 122 of file bridge.\-c.



Referenced by tcp\-\_\-data\-\_\-connect\-\_\-callback().

\hypertarget{bridge_8c_a619c74cf1ce880ac9e37bebdd33fc1ab}{\index{bridge.\-c@{bridge.\-c}!tcp\-\_\-data\-\_\-receive\-\_\-callback@{tcp\-\_\-data\-\_\-receive\-\_\-callback}}
\index{tcp\-\_\-data\-\_\-receive\-\_\-callback@{tcp\-\_\-data\-\_\-receive\-\_\-callback}!bridge.c@{bridge.\-c}}
\subsubsection[{tcp\-\_\-data\-\_\-receive\-\_\-callback}]{\setlength{\rightskip}{0pt plus 5cm}static I\-C\-A\-C\-H\-E\-\_\-\-F\-L\-A\-S\-H\-\_\-\-A\-T\-T\-R void tcp\-\_\-data\-\_\-receive\-\_\-callback (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{arg, }
\item[{char $\ast$}]{data, }
\item[{{\bf uint16\-\_\-t}}]{length}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{bridge_8c_a619c74cf1ce880ac9e37bebdd33fc1ab}


Network receive callback function. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em $\ast$arg} & unused \\
\hline
\mbox{\tt in}  & {\em $\ast$data} & Data received \\
\hline
\mbox{\tt in}  & {\em length} & Length of data received \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}


Definition at line 92 of file bridge.\-c.



Referenced by tcp\-\_\-data\-\_\-connect\-\_\-callback().

\hypertarget{bridge_8c_a9479d1a576b84bc3e8438f9446dda1a6}{\index{bridge.\-c@{bridge.\-c}!tcp\-\_\-data\-\_\-sent\-\_\-callback@{tcp\-\_\-data\-\_\-sent\-\_\-callback}}
\index{tcp\-\_\-data\-\_\-sent\-\_\-callback@{tcp\-\_\-data\-\_\-sent\-\_\-callback}!bridge.c@{bridge.\-c}}
\subsubsection[{tcp\-\_\-data\-\_\-sent\-\_\-callback}]{\setlength{\rightskip}{0pt plus 5cm}static I\-C\-A\-C\-H\-E\-\_\-\-F\-L\-A\-S\-H\-\_\-\-A\-T\-T\-R void tcp\-\_\-data\-\_\-sent\-\_\-callback (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{arg}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{bridge_8c_a9479d1a576b84bc3e8438f9446dda1a6}


Network transmit finished callback function. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em $\ast$arg} & unused \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}


Definition at line 77 of file bridge.\-c.



Referenced by tcp\-\_\-data\-\_\-connect\-\_\-callback().



\subsection{Variable Documentation}
\hypertarget{bridge_8c_ad261f9ed25a58b55949fac376fd1e0af}{\index{bridge.\-c@{bridge.\-c}!bridge\-\_\-task\-\_\-queue@{bridge\-\_\-task\-\_\-queue}}
\index{bridge\-\_\-task\-\_\-queue@{bridge\-\_\-task\-\_\-queue}!bridge.c@{bridge.\-c}}
\subsubsection[{bridge\-\_\-task\-\_\-queue}]{\setlength{\rightskip}{0pt plus 5cm}os\-\_\-event\-\_\-t bridge\-\_\-task\-\_\-queue\mbox{[}{\bf bridge\-\_\-task\-\_\-queue\-\_\-length}\mbox{]}}}\label{bridge_8c_ad261f9ed25a58b55949fac376fd1e0af}


E\-S\-P8266 O\-S task queue. 



Definition at line 30 of file bridge.\-c.



Referenced by bridge\-\_\-task\-\_\-init().

\hypertarget{bridge_8c_a4603e319b9122f08d771fd0cffcd624b}{\index{bridge.\-c@{bridge.\-c}!esp\-\_\-data\-\_\-tcp\-\_\-connection@{esp\-\_\-data\-\_\-tcp\-\_\-connection}}
\index{esp\-\_\-data\-\_\-tcp\-\_\-connection@{esp\-\_\-data\-\_\-tcp\-\_\-connection}!bridge.c@{bridge.\-c}}
\subsubsection[{esp\-\_\-data\-\_\-tcp\-\_\-connection}]{\setlength{\rightskip}{0pt plus 5cm}struct espconn$\ast$ esp\-\_\-data\-\_\-tcp\-\_\-connection\hspace{0.3cm}{\ttfamily [static]}}}\label{bridge_8c_a4603e319b9122f08d771fd0cffcd624b}


network connection 



Definition at line 45 of file bridge.\-c.



Referenced by bridge\-\_\-task(), bridge\-\_\-task\-\_\-init(), tcp\-\_\-data\-\_\-connect\-\_\-callback(), and tcp\-\_\-data\-\_\-disconnect\-\_\-callback().

\hypertarget{bridge_8c_a543efc3afa23ef26b2799af3a29389b5}{\index{bridge.\-c@{bridge.\-c}!tcp\-\_\-data\-\_\-send\-\_\-buffer@{tcp\-\_\-data\-\_\-send\-\_\-buffer}}
\index{tcp\-\_\-data\-\_\-send\-\_\-buffer@{tcp\-\_\-data\-\_\-send\-\_\-buffer}!bridge.c@{bridge.\-c}}
\subsubsection[{tcp\-\_\-data\-\_\-send\-\_\-buffer}]{\setlength{\rightskip}{0pt plus 5cm}char$\ast$ tcp\-\_\-data\-\_\-send\-\_\-buffer\hspace{0.3cm}{\ttfamily [static]}}}\label{bridge_8c_a543efc3afa23ef26b2799af3a29389b5}


T\-C\-P send buffer. 



Definition at line 39 of file bridge.\-c.



Referenced by bridge\-\_\-task(), and bridge\-\_\-task\-\_\-init().

\hypertarget{bridge_8c_a36560c07b79d9d574575c3e54f24b032}{\index{bridge.\-c@{bridge.\-c}!tcp\-\_\-data\-\_\-send\-\_\-buffer\-\_\-busy@{tcp\-\_\-data\-\_\-send\-\_\-buffer\-\_\-busy}}
\index{tcp\-\_\-data\-\_\-send\-\_\-buffer\-\_\-busy@{tcp\-\_\-data\-\_\-send\-\_\-buffer\-\_\-busy}!bridge.c@{bridge.\-c}}
\subsubsection[{tcp\-\_\-data\-\_\-send\-\_\-buffer\-\_\-busy}]{\setlength{\rightskip}{0pt plus 5cm}char tcp\-\_\-data\-\_\-send\-\_\-buffer\-\_\-busy\hspace{0.3cm}{\ttfamily [static]}}}\label{bridge_8c_a36560c07b79d9d574575c3e54f24b032}


T\-C\-P send buffer busy flag. 



Definition at line 41 of file bridge.\-c.



Referenced by bridge\-\_\-task(), tcp\-\_\-data\-\_\-connect\-\_\-callback(), and tcp\-\_\-data\-\_\-sent\-\_\-callback().

\hypertarget{bridge_8c_ab25ba18581f43bfb622b9265183a501c}{\index{bridge.\-c@{bridge.\-c}!uart\-\_\-receive\-\_\-queue@{uart\-\_\-receive\-\_\-queue}}
\index{uart\-\_\-receive\-\_\-queue@{uart\-\_\-receive\-\_\-queue}!bridge.c@{bridge.\-c}}
\subsubsection[{uart\-\_\-receive\-\_\-queue}]{\setlength{\rightskip}{0pt plus 5cm}{\bf queue\-\_\-t}$\ast$ uart\-\_\-receive\-\_\-queue}}\label{bridge_8c_ab25ba18581f43bfb622b9265183a501c}


uart receive queue 

\begin{DoxySeeAlso}{See Also}
\hyperlink{queue_8c}{queue.\-c} 
\end{DoxySeeAlso}


Definition at line 37 of file bridge.\-c.

\hypertarget{bridge_8c_a1b67aab34790ec2d9256a1b50eecadb6}{\index{bridge.\-c@{bridge.\-c}!uart\-\_\-send\-\_\-queue@{uart\-\_\-send\-\_\-queue}}
\index{uart\-\_\-send\-\_\-queue@{uart\-\_\-send\-\_\-queue}!bridge.c@{bridge.\-c}}
\subsubsection[{uart\-\_\-send\-\_\-queue}]{\setlength{\rightskip}{0pt plus 5cm}{\bf queue\-\_\-t}$\ast$ uart\-\_\-send\-\_\-queue}}\label{bridge_8c_a1b67aab34790ec2d9256a1b50eecadb6}


uart send queue 

uart send and receive queue,

\begin{DoxySeeAlso}{See Also}
\hyperlink{queue_8c}{queue.\-c} 
\end{DoxySeeAlso}


Definition at line 34 of file bridge.\-c.

