\hypertarget{sys_8h}{\section{utils/sys.h File Reference}
\label{sys_8h}\index{utils/sys.\-h@{utils/sys.\-h}}
}


System utilities.  


{\ttfamily \#include $<$user\-\_\-config.\-h$>$}\\*
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{sys_8h_ae9739bcecd10d5962cc10c12bf01594f}{H\-E\-A\-P\-\_\-\-S\-T\-A\-R\-T}~((\hyperlink{send_8c_a435d1572bf3f880d55459d9805097f62}{uint32\-\_\-t}) \& (\hyperlink{sys_8h_ab750b0b8889cb7d718f12d66f01fd954}{\-\_\-heap\-\_\-start}))
\item 
\#define \hyperlink{sys_8h_a7437bbfa3a1415a7d91fded74239a762}{H\-E\-A\-P\-\_\-\-E\-N\-D}~((\hyperlink{send_8c_a435d1572bf3f880d55459d9805097f62}{uint32\-\_\-t}) (0x3\-F\-F\-F\-C000\-U -\/ 1\-U))
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{user__config_8h_ad0fe97585b8891f5e4f2b9a6426330a4}{M\-E\-M\-S\-P\-A\-C\-E} void $\ast$ \hyperlink{sys_8h_a22b308551dea873face80619301d5618}{malloc} (size\-\_\-t size)
\begin{DoxyCompactList}\small\item\em calloc may be aliased to safecalloc \end{DoxyCompactList}\item 
\hyperlink{user__config_8h_ad0fe97585b8891f5e4f2b9a6426330a4}{M\-E\-M\-S\-P\-A\-C\-E} void $\ast$ \hyperlink{sys_8h_ae148919146e88c7c40c7e2f781649b31}{calloc} (size\-\_\-t nmemb, size\-\_\-t size)
\begin{DoxyCompactList}\small\item\em calloc buffer P\-O\-S\-I\-X function \end{DoxyCompactList}\item 
\hyperlink{user__config_8h_ad0fe97585b8891f5e4f2b9a6426330a4}{M\-E\-M\-S\-P\-A\-C\-E} void \hyperlink{sys_8h_a0f8c52d1c359b700088f8417b48e467b}{free} (void $\ast$p)
\begin{DoxyCompactList}\small\item\em Free buffer P\-O\-S\-I\-X function We only call os\-\_\-free() is pointer is not null. \end{DoxyCompactList}\item 
\hyperlink{user__config_8h_ad0fe97585b8891f5e4f2b9a6426330a4}{M\-E\-M\-S\-P\-A\-C\-E} \hyperlink{send_8c_a435d1572bf3f880d55459d9805097f62}{uint32\-\_\-t} \hyperlink{sys_8h_a077ad54a717a75f55a74aff8692b9be2}{free\-Ram} (void)
\begin{DoxyCompactList}\small\item\em Return Free memory. \end{DoxyCompactList}\item 
\hyperlink{user__config_8h_ad0fe97585b8891f5e4f2b9a6426330a4}{M\-E\-M\-S\-P\-A\-C\-E} void \hyperlink{sys_8h_a685d93545b12079d00ffc678d3611333}{Print\-Ram} (void)
\begin{DoxyCompactList}\small\item\em Display Free memory and regions. \end{DoxyCompactList}\item 
\hyperlink{user__config_8h_ad0fe97585b8891f5e4f2b9a6426330a4}{M\-E\-M\-S\-P\-A\-C\-E} void $\ast$ \hyperlink{sys_8h_a65ca18fba3d6cdb9ce8ca8040a96e0c5}{safecalloc} (size\-\_\-t nmemb, size\-\_\-t size)
\begin{DoxyCompactList}\small\item\em Safe Calloc -\/ Display Error message if Calloc fails. \end{DoxyCompactList}\item 
\hyperlink{user__config_8h_ad0fe97585b8891f5e4f2b9a6426330a4}{M\-E\-M\-S\-P\-A\-C\-E} void $\ast$ \hyperlink{sys_8h_aca19f0f1e5d805c1e5f61101fa4690f1}{safemalloc} (size\-\_\-t size)
\begin{DoxyCompactList}\small\item\em Safe Malloc -\/ Display Error message if Malloc fails. \end{DoxyCompactList}\item 
\hyperlink{user__config_8h_ad0fe97585b8891f5e4f2b9a6426330a4}{M\-E\-M\-S\-P\-A\-C\-E} void \hyperlink{sys_8h_a61f06ee340417c629633142e0a5db288}{safefree} (void $\ast$p)
\begin{DoxyCompactList}\small\item\em Safe free -\/ Only free a pointer if it is in malloc memory range. We want to try to catch frees of static or bogus data. \end{DoxyCompactList}\item 
\hyperlink{user__config_8h_ad0fe97585b8891f5e4f2b9a6426330a4}{M\-E\-M\-S\-P\-A\-C\-E} void \hyperlink{sys_8h_a3d3120b9c1d6fa02648d6e317f0f6e44}{reset} (void)
\begin{DoxyCompactList}\small\item\em reset system \end{DoxyCompactList}\item 
\hyperlink{user__config_8h_ad0fe97585b8891f5e4f2b9a6426330a4}{M\-E\-M\-S\-P\-A\-C\-E} void \hyperlink{sys_8h_a9b9f170e9a01e51b57656fcda1f183df}{wdt\-\_\-reset} (void)
\begin{DoxyCompactList}\small\item\em reset watchdog \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
void $\ast$ \hyperlink{sys_8h_ab750b0b8889cb7d718f12d66f01fd954}{\-\_\-heap\-\_\-start}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
System utilities. \begin{DoxyParagraph}{Copyright \copyright{} 2015 Mike Gore, G\-P\-L License}

\end{DoxyParagraph}
\begin{DoxyParagraph}{You are free to use this code under the terms of G\-P\-L}
please retain a copy of this notice in any code you use it in.
\end{DoxyParagraph}
This is free software\-: you can redistribute it and/or modify it under the terms of the G\-N\-U General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.

This software is distributed in the hope that it will be useful, but W\-I\-T\-H\-O\-U\-T A\-N\-Y W\-A\-R\-R\-A\-N\-T\-Y; without even the implied warranty of M\-E\-R\-C\-H\-A\-N\-T\-A\-B\-I\-L\-I\-T\-Y or F\-I\-T\-N\-E\-S\-S F\-O\-R A P\-A\-R\-T\-I\-C\-U\-L\-A\-R P\-U\-R\-P\-O\-S\-E. See the G\-N\-U General Public License for more details.

You should have received a copy of the G\-N\-U General Public License along with this program. If not, see \href{http://www.gnu.org/licenses/}{\tt http\-://www.\-gnu.\-org/licenses/}. 

Definition in file \hyperlink{sys_8h_source}{sys.\-h}.



\subsection{Macro Definition Documentation}
\hypertarget{sys_8h_a7437bbfa3a1415a7d91fded74239a762}{\index{sys.\-h@{sys.\-h}!H\-E\-A\-P\-\_\-\-E\-N\-D@{H\-E\-A\-P\-\_\-\-E\-N\-D}}
\index{H\-E\-A\-P\-\_\-\-E\-N\-D@{H\-E\-A\-P\-\_\-\-E\-N\-D}!sys.h@{sys.\-h}}
\subsubsection[{H\-E\-A\-P\-\_\-\-E\-N\-D}]{\setlength{\rightskip}{0pt plus 5cm}\#define H\-E\-A\-P\-\_\-\-E\-N\-D~(({\bf uint32\-\_\-t}) (0x3\-F\-F\-F\-C000\-U -\/ 1\-U))}}\label{sys_8h_a7437bbfa3a1415a7d91fded74239a762}


Definition at line 31 of file sys.\-h.



Referenced by Print\-Ram(), and safefree().

\hypertarget{sys_8h_ae9739bcecd10d5962cc10c12bf01594f}{\index{sys.\-h@{sys.\-h}!H\-E\-A\-P\-\_\-\-S\-T\-A\-R\-T@{H\-E\-A\-P\-\_\-\-S\-T\-A\-R\-T}}
\index{H\-E\-A\-P\-\_\-\-S\-T\-A\-R\-T@{H\-E\-A\-P\-\_\-\-S\-T\-A\-R\-T}!sys.h@{sys.\-h}}
\subsubsection[{H\-E\-A\-P\-\_\-\-S\-T\-A\-R\-T}]{\setlength{\rightskip}{0pt plus 5cm}\#define H\-E\-A\-P\-\_\-\-S\-T\-A\-R\-T~(({\bf uint32\-\_\-t}) \& ({\bf \-\_\-heap\-\_\-start}))}}\label{sys_8h_ae9739bcecd10d5962cc10c12bf01594f}


Definition at line 30 of file sys.\-h.



Referenced by Print\-Ram(), and safefree().



\subsection{Function Documentation}
\hypertarget{sys_8h_ae148919146e88c7c40c7e2f781649b31}{\index{sys.\-h@{sys.\-h}!calloc@{calloc}}
\index{calloc@{calloc}!sys.h@{sys.\-h}}
\subsubsection[{calloc}]{\setlength{\rightskip}{0pt plus 5cm}{\bf M\-E\-M\-S\-P\-A\-C\-E} void$\ast$ calloc (
\begin{DoxyParamCaption}
\item[{size\-\_\-t}]{nmemb, }
\item[{size\-\_\-t}]{size}
\end{DoxyParamCaption}
)}}\label{sys_8h_ae148919146e88c7c40c7e2f781649b31}


calloc buffer P\-O\-S\-I\-X function 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em nmemb} & number of elements \\
\hline
\mbox{\tt in}  & {\em size} & size of elements \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void $\ast$ buffer 
\end{DoxyReturn}


Definition at line 52 of file sys.\-c.



Referenced by safecalloc(), and safemalloc().

\hypertarget{sys_8h_a0f8c52d1c359b700088f8417b48e467b}{\index{sys.\-h@{sys.\-h}!free@{free}}
\index{free@{free}!sys.h@{sys.\-h}}
\subsubsection[{free}]{\setlength{\rightskip}{0pt plus 5cm}{\bf M\-E\-M\-S\-P\-A\-C\-E} void free (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{p}
\end{DoxyParamCaption}
)}}\label{sys_8h_a0f8c52d1c359b700088f8417b48e467b}


Free buffer P\-O\-S\-I\-X function We only call os\-\_\-free() is pointer is not null. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em $\ast$p} & buffer to free \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}


Definition at line 65 of file sys.\-c.



Referenced by safefree().

\hypertarget{sys_8h_a077ad54a717a75f55a74aff8692b9be2}{\index{sys.\-h@{sys.\-h}!free\-Ram@{free\-Ram}}
\index{free\-Ram@{free\-Ram}!sys.h@{sys.\-h}}
\subsubsection[{free\-Ram}]{\setlength{\rightskip}{0pt plus 5cm}{\bf M\-E\-M\-S\-P\-A\-C\-E} {\bf uint32\-\_\-t} free\-Ram (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{sys_8h_a077ad54a717a75f55a74aff8692b9be2}


Return Free memory. 

\begin{DoxyReturn}{Returns}
free memory in bytes. 
\end{DoxyReturn}
\begin{DoxySeeAlso}{See Also}
\hyperlink{sys_8c_a22b308551dea873face80619301d5618}{malloc()}. 
\end{DoxySeeAlso}


Definition at line 76 of file sys.\-c.

\hypertarget{sys_8h_a22b308551dea873face80619301d5618}{\index{sys.\-h@{sys.\-h}!malloc@{malloc}}
\index{malloc@{malloc}!sys.h@{sys.\-h}}
\subsubsection[{malloc}]{\setlength{\rightskip}{0pt plus 5cm}{\bf M\-E\-M\-S\-P\-A\-C\-E} void$\ast$ malloc (
\begin{DoxyParamCaption}
\item[{size\-\_\-t}]{size}
\end{DoxyParamCaption}
)}}\label{sys_8h_a22b308551dea873face80619301d5618}


calloc may be aliased to safecalloc 

free may be aliased to safefree malloc may be aliased to safecalloc malloc buffer P\-O\-S\-I\-X function 
\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em size} & size of buffer \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void $\ast$ buffer 
\end{DoxyReturn}


Definition at line 39 of file sys.\-c.

\hypertarget{sys_8h_a685d93545b12079d00ffc678d3611333}{\index{sys.\-h@{sys.\-h}!Print\-Ram@{Print\-Ram}}
\index{Print\-Ram@{Print\-Ram}!sys.h@{sys.\-h}}
\subsubsection[{Print\-Ram}]{\setlength{\rightskip}{0pt plus 5cm}{\bf M\-E\-M\-S\-P\-A\-C\-E} void Print\-Ram (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{sys_8h_a685d93545b12079d00ffc678d3611333}


Display Free memory and regions. 

\begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}


Definition at line 85 of file sys.\-c.



Referenced by setup().

\hypertarget{sys_8h_a3d3120b9c1d6fa02648d6e317f0f6e44}{\index{sys.\-h@{sys.\-h}!reset@{reset}}
\index{reset@{reset}!sys.h@{sys.\-h}}
\subsubsection[{reset}]{\setlength{\rightskip}{0pt plus 5cm}{\bf M\-E\-M\-S\-P\-A\-C\-E} void reset (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{sys_8h_a3d3120b9c1d6fa02648d6e317f0f6e44}


reset system 

\begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}


Definition at line 155 of file sys.\-c.



Referenced by uart0\-\_\-gets\-\_\-init().

\hypertarget{sys_8h_a65ca18fba3d6cdb9ce8ca8040a96e0c5}{\index{sys.\-h@{sys.\-h}!safecalloc@{safecalloc}}
\index{safecalloc@{safecalloc}!sys.h@{sys.\-h}}
\subsubsection[{safecalloc}]{\setlength{\rightskip}{0pt plus 5cm}{\bf M\-E\-M\-S\-P\-A\-C\-E} void$\ast$ safecalloc (
\begin{DoxyParamCaption}
\item[{size\-\_\-t}]{nmemb, }
\item[{size\-\_\-t}]{size}
\end{DoxyParamCaption}
)}}\label{sys_8h_a65ca18fba3d6cdb9ce8ca8040a96e0c5}


Safe Calloc -\/ Display Error message if Calloc fails. 


\begin{DoxyItemize}
\item We check if the pointer was in the heap.
\item Otherwise it may have been statically defined -\/ display error. 
\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em nmemb} & number of elements \\
\hline
\mbox{\tt in}  & {\em size} & size of elements \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void. 
\end{DoxyReturn}

\end{DoxyItemize}

Definition at line 100 of file sys.\-c.

\hypertarget{sys_8h_a61f06ee340417c629633142e0a5db288}{\index{sys.\-h@{sys.\-h}!safefree@{safefree}}
\index{safefree@{safefree}!sys.h@{sys.\-h}}
\subsubsection[{safefree}]{\setlength{\rightskip}{0pt plus 5cm}{\bf M\-E\-M\-S\-P\-A\-C\-E} void safefree (
\begin{DoxyParamCaption}
\item[{void $\ast$}]{p}
\end{DoxyParamCaption}
)}}\label{sys_8h_a61f06ee340417c629633142e0a5db288}


Safe free -\/ Only free a pointer if it is in malloc memory range. We want to try to catch frees of static or bogus data. 

F\-I\-X\-M\-E H\-E\-A\-P\-\_\-\-E\-N\-D is not likely exact If it is not exact it is larger or equal so the test is usefull
\begin{DoxyItemize}
\item We check if the pointer was in the heap.
\item Otherwise it may have been statically defined -\/ display error. 
\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em p} & pointer to free. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void. 
\end{DoxyReturn}

\end{DoxyItemize}

Definition at line 139 of file sys.\-c.

\hypertarget{sys_8h_aca19f0f1e5d805c1e5f61101fa4690f1}{\index{sys.\-h@{sys.\-h}!safemalloc@{safemalloc}}
\index{safemalloc@{safemalloc}!sys.h@{sys.\-h}}
\subsubsection[{safemalloc}]{\setlength{\rightskip}{0pt plus 5cm}{\bf M\-E\-M\-S\-P\-A\-C\-E} void$\ast$ safemalloc (
\begin{DoxyParamCaption}
\item[{size\-\_\-t}]{size}
\end{DoxyParamCaption}
)}}\label{sys_8h_aca19f0f1e5d805c1e5f61101fa4690f1}


Safe Malloc -\/ Display Error message if Malloc fails. 


\begin{DoxyItemize}
\item We check if the pointer was in the heap.
\item Otherwise it may have been statically defined -\/ display error. 
\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em size} & size \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void. 
\end{DoxyReturn}

\end{DoxyItemize}

Definition at line 117 of file sys.\-c.

\hypertarget{sys_8h_a9b9f170e9a01e51b57656fcda1f183df}{\index{sys.\-h@{sys.\-h}!wdt\-\_\-reset@{wdt\-\_\-reset}}
\index{wdt\-\_\-reset@{wdt\-\_\-reset}!sys.h@{sys.\-h}}
\subsubsection[{wdt\-\_\-reset}]{\setlength{\rightskip}{0pt plus 5cm}{\bf M\-E\-M\-S\-P\-A\-C\-E} void wdt\-\_\-reset (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{sys_8h_a9b9f170e9a01e51b57656fcda1f183df}


reset watchdog 

\begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}


Definition at line 164 of file sys.\-c.



Referenced by f\-\_\-getfree(), f\-\_\-mkfs(), fatfs\-\_\-scan\-\_\-files(), mmc\-\_\-power\-\_\-on(), setup(), and wire\-\_\-draw().



\subsection{Variable Documentation}
\hypertarget{sys_8h_ab750b0b8889cb7d718f12d66f01fd954}{\index{sys.\-h@{sys.\-h}!\-\_\-heap\-\_\-start@{\-\_\-heap\-\_\-start}}
\index{\-\_\-heap\-\_\-start@{\-\_\-heap\-\_\-start}!sys.h@{sys.\-h}}
\subsubsection[{\-\_\-heap\-\_\-start}]{\setlength{\rightskip}{0pt plus 5cm}void$\ast$ \-\_\-heap\-\_\-start}}\label{sys_8h_ab750b0b8889cb7d718f12d66f01fd954}
